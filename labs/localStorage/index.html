<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
        <!-- json2 - serializes and deserializes objects into JSON formatted string -->
        <script src="https://github.com/douglascrockford/JSON-js/raw/master/json2.js"></script>
        <script>
            // extend browser Storage object with
            // setObject() and getObject() methods
            // as suggested at
            // http://stackoverflow.com/questions/2010892/storing-objects-in-html5-localstorage
            Storage.prototype.setObject = function(key, value) {
                this.setItem(key, JSON.stringify(value));
            }
            Storage.prototype.getObject = function(key) {
                return this.getItem(key) && JSON.parse(this.getItem(key));
            }

            // checks in browser supports local storage
            function supports_html5_storage() {
              try {
                return 'localStorage' in window && window['localStorage'] !== null;
              } catch (e) {
                return false;
              }
            }

            // display array data as unordered list
            function show()
            {
                var array_data = get_array_data();
                $("#show").text("");
                for(var item in array_data)
                    $("#show").append($("<li />").text(array_data[item]));
            }

            // get array data from local storage
            function get_array_data()
            {
                var array_data;
                try
                {
                    array_data = localStorage.getObject("array_data");
                }
                catch (e) {
                    // object may contain string data which can't
                    // be parsed into object
                }
                // get empty array if data is not available
                if(!array_data) array_data = [];
                return array_data;
            }

            $(document).ready(function()
            {
                // show browser info
                $("#message").text(supports_html5_storage() ?
                    "Local storage available" : "Local storage NOT available");

                $("#add").click(function()
                {
                    // get value from textbox
                    var newValue = $("#str_value").val();
                    var array_data = get_array_data();
                    // add new value to array
                    array_data.push(newValue);
                    // and save into local storage
                    localStorage.setObject("array_data", array_data);

                    show();
                    $("#str_value").val("")
                    return false;
                });

                // reset local storage data
                $("#reset").click(function() {
                     localStorage.setObject("array_data", []);
                     show();
                });

                // display local storage value
                show();
            });
        </script>
    </head>
    <body>
        <h1>Storing objects in HTML5 local storage demo</h1>
        <p id="message"></p>
        <ul id="show"></ul>
        <input type="text" id="str_value" />
        <input type="submit" id="add" value="Add"></input>
        <input type="submit" id="reset" value="Reset"></input>
    </body>
</html>
