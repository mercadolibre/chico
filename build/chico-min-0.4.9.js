/**
  * Chico-UI
  * Packer-o-matic
  * Like the pizza delivery service: "Les than 100 milisecons delivery guarantee!"
  * @components: core, positioner, object, floats, navs, controllers, watcher, carousel, dropdown, layer, modal, tabNavigator, tooltip, string, number, required, helper, forms, viewer, chat, expando
  * @version 0.4
  * @autor Chico Team <chico@mercadolibre.com>
  *
  * @based on:
  * JSMin
  * @author Ryan Grove <ryan@wonko.com> 
  * @copyright 2002 Douglas Crockford <douglas@crockford.com> (jsmin.c) 
  * @copyright 2008 Ryan Grove <ryan@wonko.com> (PHP port) 
  * @link http://code.google.com/p/jsmin-php/ 
  */
;(function($){

var ui=window.ui={version:"0.4.9",components:"carousel,dropdown,layer,modal,tabNavigator,tooltip,string,number,required,helper,forms,viewer,chat,expando",internals:"positioner,object,floats,navs,controllers,watcher",instances:{},features:{},init:function(){$("html").removeClass("no-js");ui.features=ui.support();ui.components=(window.components)?ui.components+","+window.components:ui.components;ui.internals=(window.internals)?ui.internals+","+window.internals:ui.internals;$(ui.components.split(",")).each(function(i,e){ui.factory({component:e});});},utils:{body:$('body'),html:$('html'),window:$(window),document:$(document),zIndex:1000,index:0},events:{CHANGE_LAYOUT:"changeLayout"}}
ui.factory=function(o){if(!o){alert("Factory fatal error: Need and object {component:\"\"} to configure a component.");return;};if(!o.component){alert("Factory fatal error: No component defined.");return;};var x=o.component;var create=function(x){$.fn[x]=function(options){var results=[];var that=this;var options=options||{};var _arguments=arguments;that.each(function(i,e){var conf={};conf.name=x;conf.element=e;conf.id=ui.utils.index++;if(typeof options==="number"){conf.value=options;if(_arguments[1]){conf.msg=_arguments[1];}}
if(typeof options==="string"){conf.msg=options;}
if(typeof options==="object"){$.extend(conf,options);}
var created=ui[x](conf);if(created.type){var type=created.type;if(!ui.instances[type]){ui.instances[type]=[];}
ui.instances[type].push(created);}
if(created.exists){created=created.object;}
results.push(created);});return(results.length>1)?results:results[0];}
if(o.callback){o.callback();}}
if(ui[o.component]){create(o.component);}else{ui.get({"method":"component","component":o.component,"script":(o.script)?o.script:"src/js/"+o.component+".js","styles":(o.style)?o.style:"src/css/"+x+".css","callback":create});}}
ui.get=function(o){switch(o.method){case"content":var result;var x=o.conf;x.$htmlContent.html('<div class="loading"></div>');$.ajax({url:x.ajaxUrl,type:x.ajaxType||'POST',data:x.ajaxParams,cache:true,async:false,success:function(data,textStatus,xhr){result=data;if(x.callbacks&&x.callbacks.success)x.callbacks.success(data,textStatus,xhr);},error:function(xhr,textStatus,errorThrown){result=(x.callbacks&&x.callbacks.error)?x.callbacks.error(xhr,textStatus,errorThrown):"<p>Error on ajax call</p>";}});return result;break;case"component":if(o.style){var style=document.createElement('link');style.href=o.style;style.rel='stylesheet';style.type='text/css';}
if(o.script){var script=document.createElement("script");script.src=o.script;}
var head=document.getElementsByTagName("head")[0]||document.documentElement;var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;if(o.callback){o.callback(o.component);}
script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}}};if(o.script){head.insertBefore(script,head.firstChild);}
if(o.style){head.appendChild(style);}
break;}}
ui.support=function(){var transition=(function(){var thisBody=document.body||document.documentElement;var thisStyle=thisBody.style;return thisStyle.WebkitTransition!==undefined||thisStyle.MozTransition!==undefined||thisStyle.OTransition!==undefined||thisStyle.transition!==undefined;})();return{transition:transition};};ui.positioner=function(o){var element=$(o.element);var context;var viewport;if(!o.points)o.points="cm cm";if(!o.offset)o.offset="0 0";var classReferences={"lt lb":"down","lb lt":"top","rt rb":"down","rb rt":"top","lt rt":"right","cm cm":"center"};var splittedOffset=o.offset.split(" ");var offset_left=parseInt(splittedOffset[0]);var offset_top=parseInt(splittedOffset[1]);var getViewport=function(){var viewport;var width;var height;var left;var top;var pageX;var pageY;if(typeof window.innerWidth!="undefined"){viewport=window;width=viewport.innerWidth;height=viewport.innerHeight;pageX=viewport.pageXOffset;pageY=viewport.pageYOffset;left=0+offset_left+pageX;top=0+offset_top+pageY;bottom=height+pageY;right=width+pageX;}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!='undefined'&&document.documentElement.clientWidth!=0){viewport=document.documentElement;width=viewport.clientWidth;height=viewport.clientHeight;pageX=viewport.scrollLeft;pageY=viewport.scrollTop;left=0+offset_left+pageX;top=0+offset_top+pageY;bottom=height+pageY;right=width+pageX;}
return{element:viewport,left:left,top:top,bottom:bottom,right:right,width:width,height:height}};var getPosition=function(unitPoints){var contextLeft=context.left;var contextTop=context.top;var contextWidth=context.width;var contextHeight=context.height;var elementWidth=element.outerWidth();var elementHeight=element.outerHeight();var xReferences={ll:contextLeft,lr:contextLeft+contextWidth,rr:contextLeft+contextWidth-elementWidth,cc:contextLeft+contextWidth/2-elementWidth/2}
var yReferences={tt:contextTop,tb:contextTop+contextHeight,bt:contextTop-elementHeight,mm:contextTop+contextHeight/2-elementHeight/2}
var axis={left:xReferences[unitPoints.my_x+unitPoints.at_x],top:yReferences[unitPoints.my_y+unitPoints.at_y]}
return axis;};var calculatePoints=function(points,unitPoints){var styles=getPosition(unitPoints);styles.direction=classReferences[points];if((points=="lt lb")&&((styles.top+element.outerHeight())>viewport.bottom)){unitPoints.my_y="b";unitPoints.at_y="t";styles=getPosition(unitPoints);styles.direction="top";styles.top-=context.height;};if((styles.left+element.outerWidth())>viewport.right){unitPoints.my_x="r";unitPoints.at_x="r";var current=styles.direction;styles=getPosition(unitPoints);styles.direction=current+"-right";if(current=="top")styles.top-=context.height;};return styles;};var setPosition=function(){var splitted=o.points.split(" ");var unitPoints={my_x:splitted[0].slice(0,1),my_y:splitted[0].slice(1,2),at_x:splitted[1].slice(0,1),at_y:splitted[1].slice(1,2)}
var styles=calculatePoints(o.points,unitPoints);element.css({left:styles.left,top:styles.top}).removeClass("ch-top ch-left ch-down ch-right ch-down-right ch-top-right").addClass("ch-"+styles.direction);};var getContext=function(){if(o.context){var contextOffset=o.context.offset();context={element:o.context,top:contextOffset.top+offset_top,left:contextOffset.left+offset_left,width:o.context.outerWidth(),height:o.context.outerHeight()};}else{context=viewport;};return context;};var initPosition=function(){viewport=getViewport();context=getContext();setPosition();};initPosition();ui.utils.window.bind("resize scroll",initPosition);return $(element);};ui.object=function(){var that=this;return{prevent:function(event){if(event){event.preventDefault();event.stopPropagation();}},loadContent:function(conf){if(conf.ajax&&conf.content){alert('UI: "Ajax" and "Content" can\'t live together.');return;};if(!conf.ajax)return($(conf.content).length>0)?$(conf.content).clone().show():conf.content;if(conf.ajax===true){conf.ajaxUrl=conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action');conf.ajaxParams='x=x';if(conf.$trigger.attr('type')=='submit'){conf.ajaxType=conf.$trigger.parents('form').attr('method')||'POST';var serialized=conf.$trigger.parents('form').serialize();conf.ajaxParams=conf.ajaxParams+((serialized!='')?'&'+serialized:'');};return ui.get({method:"content",conf:conf})||'<p>Error on ajax call</p>';}else if(conf.ajax.match(/(?:(?:(https?|file):\/\/)([^\/]+)(\/(?:[^\s])+)?)|(\/(?:[^\s])+)/g)){conf.ajaxUrl=conf.ajax;conf.ajaxParams='x=x';return ui.get({method:"content",conf:conf});}else{alert('UI: "Ajax" attribute error.');return;};},callbacks:function(conf,when){if(conf.callbacks&&conf.callbacks[when])conf.callbacks[when](conf.publish);},publish:{}};}
ui.floats=function(){var that=ui.object();var createClose=function(conf){$('<p class="btn ch-close">x</p>').bind('click',function(event){that.hide(event,conf);}).prependTo(conf.$htmlContent);};var createCone=function(conf){$('<div class="ch-cone"></div>').prependTo(conf.$htmlContent);};that.show=function(event,conf){that.prevent(event);if(conf.visible)return;conf.$htmlContent=$('<div class="ch-'+conf.name+'">');conf.$htmlContent.hide().css("z-index",ui.utils.zIndex++).appendTo("body").html(that.loadContent(conf));if(conf.closeButton)createClose(conf);if(conf.cone)createCone(conf);if(conf.classes)conf.$htmlContent.addClass(conf.classes);if(conf.hasOwnProperty("width"))conf.$htmlContent.css("width",conf.width);if(conf.hasOwnProperty("height"))conf.$htmlContent.css("height",conf.height);conf.position.element=conf.$htmlContent;ui.positioner(conf.position);conf.visible=true;conf.$htmlContent.fadeIn('fast',function(){that.callbacks(conf,'show');});};that.hide=function(event,conf){that.prevent(event);if(!conf.visible)return;conf.$htmlContent.fadeOut('fast',function(event){$(this).remove();});conf.visible=false;that.callbacks(conf,'hide');};that.position=function(o,conf){switch(typeof o){case"object":conf.position.context=o.context||conf.position.context;conf.position.points=o.points||conf.position.points;conf.position.offset=o.offset||conf.position.offset;conf.position.fixed=o.fixed||conf.position.fixed;ui.positioner(conf.position);return conf.publish;break;case"string":if(o!="refresh"){alert("ChicoUI error: position() expected to find \"refresh\" parameter.");};ui.positioner(conf.position);return conf.publish;break;case"undefined":return conf.position;break;};};return that;}
ui.navs=function(){var that=ui.object();that.status=false;that.show=function(event,conf){that.prevent(event);that.status=true;conf.$trigger.addClass('ch-'+conf.name+'-on');conf.$htmlContent.show();that.callbacks(conf,'show');};that.hide=function(event,conf){that.prevent(event);that.status=false;conf.$trigger.removeClass('ch-'+conf.name+'-on');conf.$htmlContent.hide();that.callbacks(conf,'hide');};return that;}
ui.controllers=function(){var that=ui.object();that.children=[];return that;};ui.watcher=function(conf){if(!conf){alert("Watcher fatal error: Need a configuration object to create a validation.");}
var that=ui.object();var checkInstance=function(conf){var instance=ui.instances.watcher;if(instance&&instance.length>0){for(var i=0,j=instance.length;i<j;i++){if(instance[i].element===conf.element){$.extend(instance[i].validations,getValidations(conf));$.extend(instance[i].conditions,getConditions(conf));$.extend(instance[i].messages,conf.messages);instance[i].types=mergeTypes(instance[i].types);return{exists:true,object:instance[i]};}}}};var mergeTypes=function(types){if(!types||types==""){return conf.types;}else{var currentTypes=types.split(",");var newTypes=conf.types.split(",");var toMerge=[];var e=0;g=newTypes.length;for(e;e<g;e++){if(types.indexOf(newTypes[e])===-1){toMerge.push(newTypes[e]);}}
if(toMerge.length>0){$.merge(currentTypes,toMerge);}
return currentTypes.join(",");}}
var getReference=function(conf){var reference;if($(conf.element).hasClass("options")){if($(conf.element).find('h4').length>0){var h4=$(conf.element).find('h4');h4.wrapInner('<span>');reference=h4.children();}else if($(conf.element).prev().attr('tagName')=='LEGEND'){reference=$(conf.element).prev();};}else{reference=$(conf.element);};return reference;}
var getParent=function(conf){if(ui.instances.forms.length>0){var i=0,j=ui.instances.forms.length;for(i;i<j;i++){if(ui.instances.forms[i].element===$(conf.element).parents("form")[0]){return ui.instances.forms[i];}};}else{$(conf.element).parents("form").forms();var last=(ui.instances.forms.length-1);return ui.instances.forms[last];};}
var getValidations=function(conf){var collection={};var types=conf.types.split(",");for(var i=0,j=types.length;i<j;i++){for(var val in conf){if(types[i]==val){collection[val]=conf[val];};};};return collection;};var getConditions=function(conf){var collection={};var types=conf.types.split(",");for(var i=0,j=types.length;i<j;i++){for(var val in conf){if(types[i]==val){collection[val]=conf.conditions[val];};};};return collection;};var getMessages=function(conf){var messages={};for(var msg in conf.messages){messages[msg]=conf.messages[msg];}
return messages;};that.status=true;that.types=conf.types;that.reference=conf.reference=getReference(conf);that.parent=conf.parent=getParent(conf);that.validations=getValidations(conf);that.conditions=getConditions(conf);that.messages=getMessages(conf);that.defaultMessages=conf.defaultMessages;that.helper=ui.helper(conf);that.validate=function(conf){if($(conf.element).attr('disabled')){return;};if(that.publish.types.indexOf("required")==-1&&that.isEmpty(conf)){return;};for(var type in that.validations){var condition=that.conditions[type];var value=$(conf.element).val();var gotError=true;if(condition.patt){gotError=condition.patt.test(value);};if(condition.expr){gotError=condition.expr((type.indexOf("Length")>-1)?value.length:value,that.validations[type]);};if(condition.func){gotError=!that.isEmpty(conf);};if(!gotError){$(conf.element).addClass("error");if(!conf.status){that.helper.hide();};that.helper.show((that.messages[type])?that.messages[type]:that.defaultMessages[type]);that.publish.status=that.status=conf.status=false;var revalidate=function(){that.validate(conf);that.parent.checkStatus();}
var event=(conf.tag=='OPTIONS'||conf.tag=='SELECT')?"change":"blur";$(conf.element).one(event,revalidate);return;};};if(!conf.status){$(conf.element).removeClass("error");that.helper.hide();that.publish.status=that.status=conf.status=true;$(conf.element).unbind((conf.tag=='OPTIONS'||conf.tag=='SELECT')?"change":"blur");};that.callbacks(conf,'validate');};that.reset=function(conf){that.publish.status=that.status=conf.status=true;$(conf.element).removeClass("error");that.helper.hide();$(conf.element).unbind("blur");that.callbacks(conf,'reset');};that.isEmpty=function(conf){conf.tag=($(conf.element).hasClass("options"))?"OPTIONS":conf.element.tagName;switch(conf.tag){case'OPTIONS':return $(conf.element).find('input:checked').length==0;break;case'SELECT':var val=$(conf.element).val();return val==-1||val==null;break;case'INPUT':case'TEXTAREA':return $.trim($(conf.element).val()).length==0;break;};};that.publish={uid:conf.id,element:conf.element,type:"watcher",types:that.types,status:that.status,reference:that.reference,parent:that.parent,validations:that.validations,conditions:that.conditions,messages:that.messages,and:function(){return $(conf.element);},reset:function(){that.reset(conf);return that.publish;},validate:function(){that.validate(conf);return that.publish;},refresh:function(){return that.helper.position("refresh");}};var check=checkInstance(conf);if(check){var that={};that.publish=check;}else{that.parent.children.push(that.publish);}
return that;};ui.carousel=function(conf){var that=ui.object();var status=false;var page=1;conf.$trigger=$(conf.element).addClass('ch-carousel');conf.$htmlContent=$(conf.element).find('.carousel').addClass('ch-carousel-content');conf.publish=that.publish;var htmlElementMargin=(ui.utils.html.hasClass("ie6"))?21:20;var extraWidth=(ui.utils.html.hasClass("ie6"))?conf.$htmlContent.children().outerWidth():0;var htmlContentWidth=conf.$htmlContent.children().size()*(conf.$htmlContent.children().outerWidth()+htmlElementMargin)+extraWidth;conf.$htmlContent.wrap($('<div>').addClass('ch-mask')).css('width',htmlContentWidth);var $mask=conf.$trigger.find('.ch-mask');var steps=~~((conf.$trigger.width()-70)/(conf.$htmlContent.children().outerWidth()+20));steps=(steps==0)?1:steps;var totalPages=Math.ceil(conf.$htmlContent.children().size()/steps);var moveTo=(conf.$htmlContent.children().outerWidth()+20)*steps;var margin=($mask.width()-moveTo)/2;$mask.width(moveTo).height(conf.$htmlContent.children().outerHeight()+2);if($.browser.msie&&$.browser.version=='6.0')htmlContentWidth=htmlContentWidth-(conf.$htmlContent.children().outerWidth()*2);var buttons={prev:{$element:$('<p class="ch-prev">Previous</p>').bind('click',function(){move("prev",1)}).css('top',(conf.$trigger.outerHeight()-22)/2),on:function(){buttons.prev.$element.addClass("ch-prev-on")},off:function(){buttons.prev.$element.removeClass("ch-prev-on")}},next:{$element:$('<p class="ch-next">Next</p>').bind('click',function(){move("next",1)}).css('top',(conf.$trigger.outerHeight()-22)/2),on:function(){buttons.next.$element.addClass("ch-next-on")},off:function(){buttons.next.$element.removeClass("ch-next-on")}}};conf.$trigger.prepend(buttons.prev.$element).append(buttons.next.$element);if(htmlContentWidth>$mask.width())buttons.next.on();var move=function(direction,distance){var movement;switch(direction){case"prev":if(status||(page-distance)<=0)return;page-=distance;movement=conf.$htmlContent.position().left+(moveTo*distance);if(page==1)buttons.prev.off();buttons.next.on();break;case"next":if(status||(page+distance)>totalPages)return;page+=distance;movement=conf.$htmlContent.position().left-(moveTo*distance);if(page==totalPages)buttons.next.off();buttons.prev.on();break;};status=true;var afterMove=function(){status=false;if(conf.pager){$(".ch-pager li").removeClass("ch-pager-on");$(".ch-pager li:nth-child("+page+")").addClass("ch-pager-on");};that.callbacks(conf,direction);};if(ui.features.transition){conf.$htmlContent.css({left:movement});afterMove();}else{conf.$htmlContent.animate({left:movement},afterMove);};return conf.publish;};var select=function(item){var itemPage=~~(item/steps)+1;if(itemPage>page){move("next",itemPage-page);}else if(itemPage<page){move("prev",page-itemPage);};if(conf.pager){$(".ch-pager li").removeClass("ch-pager-on");$(".ch-pager li:nth-child("+page+")").addClass("ch-pager-on");}
that.callbacks(conf,'select');return conf.publish;};var pager=function(){var list=$("<ul class=\"ch-pager\">");var thumbs=[];for(var i=1,j=totalPages+1;i<j;i+=1){thumbs.push("<li>");thumbs.push(i);thumbs.push("</li>");};list.append(thumbs.join(""));conf.$trigger.append(list);var pager=$(".ch-pager");var contextWidth=pager.parent().width();var pagerWidth=pager.outerWidth();pager.css('left',(contextWidth-pagerWidth)/2);pager.children().each(function(i,e){$(e).bind("click",function(){select(i);});});};if(conf.pager)pager();conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="carousel";conf.publish.getSteps=function(){return steps;};conf.publish.getPage=function(){return page;};conf.publish.select=function(item){return select(item);};conf.publish.next=function(){return move("next",1);};conf.publish.prev=function(){return move("prev",1);};return conf.publish;}
ui.dropdown=function(conf){var that=ui.navs();var skin;if($(conf.element).hasClass("ch-secondary")){$(conf.element).addClass('ch-dropdown');skin="secondary";}else{$(conf.element).addClass("ch-dropdown ch-primary");skin="primary";};conf.$trigger=$(conf.element).children(':first');conf.$htmlContent=conf.$trigger.next();conf.publish=that.publish;var show=function(event){that.prevent(event);if(that.status){return hide();};$(ui.instances.dropdown).each(function(i,e){e.hide()});conf.$htmlContent.css('z-index',ui.utils.zIndex++);that.show(event,conf);if(skin=="secondary"){conf.$trigger.css('z-index',ui.utils.zIndex++);$(conf.element).addClass("ch-dropdown-on");};ui.utils.document.one('click',function(event){that.prevent(event);hide();});return conf.publish;};var hide=function(event){that.prevent(event);if(skin=="secondary"){$(conf.element).removeClass("ch-dropdown-on");};that.hide(event,conf);return conf.publish;};conf.$trigger.bind('click',function(event){that.prevent(event);show();}).addClass('ch-dropdown-trigger').append('<span class="ch-down">&raquo;</span>');conf.$htmlContent.bind('click',function(event){event.stopPropagation()}).addClass('ch-dropdown-content').find('a').bind('click',function(){hide()});conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="dropdown";conf.publish.show=function(){return show()};conf.publish.hide=function(){return hide()};return conf.publish;};ui.layer=function(conf){var that=ui.floats();var showTime=conf.showTime||300;var hideTime=conf.hideTime||300;var st,ht;var showTimer=function(event){st=setTimeout(function(){show(event)},showTime)};var hideTimer=function(event){ht=setTimeout(function(){hide(event)},hideTime)};var clearTimers=function(){clearTimeout(st);clearTimeout(ht);};conf.$trigger=$(conf.element);conf.cone=true;conf.classes='box';conf.visible=false;conf.position={context:conf.$trigger,offset:conf.offset||"0 10",points:conf.points||"lt lb"}
conf.publish=that.publish;var show=function(event){that.show(event,conf);if(conf.event==="click"){$('.ch-layer').bind('click',function(event){event.stopPropagation()});$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});}
return conf.publish;}
var hide=function(event){that.hide(event,conf);return conf.publish;}
if(conf.event==='click'){conf.closeButton=true;conf.$trigger.css('cursor','pointer').bind('click',show);}else{conf.$trigger.css('cursor','default').bind('mouseover',showTimer).bind('mouseout',hideTimer);};conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="layer";conf.publish.content=(conf.content)?conf.content:conf.ajax;conf.publish.show=function(){return show($.Event())};conf.publish.hide=function(){return hide($.Event())};conf.publish.position=function(o){return that.position(o,conf)};ui.utils.body.bind(ui.events.CHANGE_LAYOUT,function(){that.position("refresh",conf)});return conf.publish;};ui.modal=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.closeButton=true;conf.classes='box';conf.position={fixed:true};if(!conf.hasOwnProperty("ajax")&&!conf.hasOwnProperty("content"))conf.ajax=true;conf.publish=that.publish;var show=function(event){dimmer.on();that.show(event,conf);$('.ch-modal .btn.ch-close, .closeModal').bind('click',hide);conf.$trigger.blur();return conf.publish;};var hide=function(event){dimmer.off();that.hide(event,conf);return conf.publish;};var position=function(){ui.positioner(conf.position);return conf.publish;}
var dimmer={on:function(){$('<div>').bind('click',hide).addClass('ch-dimmer').css({height:$(window).height(),display:'block',zIndex:ui.utils.zIndex++}).hide().appendTo('body').fadeIn();},off:function(){$('div.ch-dimmer').fadeOut('normal',function(){$(this).remove();});}};conf.$trigger.css('cursor','pointer').bind('click',show);conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="modal";conf.publish.content=(conf.content)?conf.content:((conf.ajax===true)?(conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action')):conf.ajax);conf.publish.show=function(){return show($.Event())};conf.publish.hide=function(){return hide($.Event())};conf.publish.position=function(o){return that.position(o,conf)};return conf.publish;};ui.tabNavigator=function(conf){var that=ui.controllers();conf.publish=that.publish;var $triggers=$(conf.element).children(':first').find('a');var $htmlContent=$(conf.element).children(':first').next();$(conf.element).addClass('ch-tabNavigator');$(conf.element).children(':first').addClass('ch-tabNavigator-triggers');$triggers.addClass('ch-tabNavigator-trigger');$htmlContent.addClass('ch-tabNavigator-content box');$.each($triggers,function(i,e){that.children.push(ui.tab(i,e,conf));});var show=function(event,tab){that.children[tab].shoot(event);return conf.publish;};conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="tabNavigator";conf.publish.tabs=that.children;conf.publish.select=function(tab){return show($.Event(),tab)};var hash=window.location.hash.replace("#!","");for(var i=that.children.length;i--;){if(that.children[i].conf.$htmlContent.attr("id")===hash){show($.Event(),i);break;}else{show($.Event(),0);};};return conf.publish;};ui.tab=function(index,element,conf){var that=ui.navs();var display=element.href.split('#');var $tabContent=$(element).parents('.ch-tabNavigator').find('#'+display[1]);that.conf={name:'tab',$trigger:$(element).addClass('ch-tabNavigator-trigger'),callbacks:conf.callbacks};var results=function(){if($tabContent.attr('id')){return $tabContent;}else{that.conf.ajax=true;var w=$('<div>').attr('id','ch-tab'+index);w.hide().appendTo(that.conf.$trigger.parents('.ch-tabNavigator').find('.ch-tabNavigator-content'));return w;};};that.conf.$htmlContent=results();if(!that.status)that.conf.$htmlContent.hide();that.shoot=function(event){that.prevent(event);var tabs=conf.publish.tabs;if(tabs[index].status)return;$.each(tabs,function(i,e){if(e.status)e.hide(event,e.conf);});if(that.conf.$htmlContent.html()==='')that.conf.$htmlContent.html(that.loadContent(that.conf));that.show(event,that.conf);};that.conf.$trigger.bind('click',function(event){that.shoot(event);window.location.hash="#!"+that.conf.$htmlContent.attr("id");});return that;}
ui.tooltip=function(conf){var that=ui.floats();conf.cone=true;conf.content=conf.element.title;conf.visible=false;conf.position={context:$(conf.element),offset:"0 10",points:"lt lb"}
conf.publish=that.publish;var show=function(event){$(conf.element).attr('title','');that.show(event,conf);return conf.publish;}
var hide=function(event){$(conf.element).attr('title',conf.content);that.hide(event,conf);return conf.publish;}
var position=function(event){ui.positioner(conf.position);return conf.publish;}
conf.$trigger=$(conf.element).css('cursor','default').bind('mouseenter',show).bind('mouseleave',hide);conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="tooltip";conf.publish.content=conf.content;conf.publish.show=function(){return show($.Event())};conf.publish.hide=function(){return hide($.Event())};conf.publish.position=function(o){return that.position(o,conf)};ui.utils.body.bind(ui.events.CHANGE_LAYOUT,function(){that.position("refresh",conf)});return that.publish;};ui.string=function(conf){conf.types="text,email,url,minLength,maxLength";conf.reference=$(conf.element);conf.conditions={text:{patt:/^([a-zA-Z\s]+)$/},email:{patt:/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/},url:{patt:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/},minLength:{expr:function(a,b){return a>=b}},maxLength:{expr:function(a,b){return a<=b}}}
conf.defaultMessages={text:"Usa sÃ³lo letras.",email:"Usa el formato nombre@ejemplo.com.",url:"Usa el formato http://www.sitio.com.",minLength:"Ingresa al menos "+conf.minLength+" caracteres.",maxLength:"El mÃ¡ximo de caracteres es "+conf.maxLength+"."};conf.messages=conf.messages||{};if(conf.msg){conf.messages.string=conf.msg;conf.msg=null;}
if(!conf.text&&!conf.email&&!conf.url&&!conf.maxLength&&!conf.minLength){conf.text=true;}
var that=ui.watcher(conf);return that.publish;};ui.email=function(conf){conf=conf||{};conf.type="email";conf.email=true;conf.messages=conf.messages||{};if(conf.msg){conf.messages.email=conf.msg;conf.msg=null;}
return ui.string(conf);}
ui.factory({component:'email'});ui.url=function(conf){conf=conf||{};conf.type="url";conf.url=true;conf.messages=conf.messages||{};if(conf.msg){conf.messages.url=conf.msg;conf.msg=null;}
return ui.string(conf);}
ui.factory({component:'url'});ui.minLength=function(conf){conf=conf||{};conf.type="minLength";conf.minLength=conf.value;conf.messages=conf.messages||{};if(conf.msg){conf.messages.minLength=conf.msg;conf.msg=null;}
return ui.string(conf);}
ui.factory({component:'minLength'});ui.maxLength=function(conf){conf=conf||{};conf.type="maxLength";conf.maxLength=conf.value;conf.messages=conf.messages||{};if(conf.msg){conf.messages.maxLength=conf.msg;conf.msg=null;}
return ui.string(conf);}
ui.factory({component:'maxLength'});ui.number=function(conf){conf.types="number,min,max";conf.reference=$(conf.element);conf.conditions={number:{patt:/^([0-9\s]+)$/},min:{expr:function(a,b){return a>=b}},max:{expr:function(a,b){return a<=b}}};conf.defaultMessages={number:"Usa sÃ³lo nÃºmeros.",min:"La cantidad mÃ­nima es "+conf.min+".",max:"La cantidad mÃ¡xima es "+conf.max+"."};conf.messages=conf.messages||{};if(conf.msg){conf.messages.number=conf.msg;conf.msg=null;}
if(!conf.number&&!conf.min&&!conf.max){conf.number=true;}
var that=ui.watcher(conf);return that.publish;};ui.min=function(conf){conf=conf||{};conf.min=conf.value;conf.messages=conf.messages||{};if(conf.msg){conf.messages.min=conf.msg;conf.msg=null;}
return ui.number(conf);}
ui.factory({component:'min'});ui.max=function(conf){conf=conf||{};conf.max=conf.value;conf.messages=conf.messages||{};if(conf.msg){conf.messages.max=conf.msg;conf.msg=null;}
return ui.number(conf);}
ui.factory({component:'max'});ui.required=function(conf){conf.required=true;conf.types="required";conf.conditions={required:{func:'!that.isEmpty'}}
conf.defaultMessages={required:"Campo requerido."};conf.messages=conf.messages||{};if(conf.msg){conf.messages.required=conf.msg;conf.msg=null;}
var that=ui.watcher(conf);return that.publish;};ui.helper=function(conf){var that=ui.floats();var _conf={};_conf.name="helper";_conf.$trigger=$(conf.element);_conf.cone=true;_conf.classes="helper"+conf.id;_conf.visible=false;_conf.position={};_conf.position.context=conf.reference;_conf.position.offset="15 0";_conf.position.points="lt rt";var hide=function(){$('.helper'+conf.id).remove();_conf.visible=false;that.callbacks(conf,'hide');};var show=function(text){_conf.content='<p><span class="ico error">Error: </span>'+text+'</p>';that.show($.Event(),_conf);};ui.utils.body.bind(ui.events.CHANGE_LAYOUT,function(){that.position("refresh",_conf)});return{show:function(text){show(text)},hide:hide,position:function(o){return that.position(o,_conf)}};};ui.forms=function(conf){if($(conf.element).find(":submit").length==0||$(conf.element).attr('action')==""){alert("Forms fatal error: The <input type=submit> is missing, or need to define a action attribute on the form tag.");return;};if(ui.instances.forms){if(ui.instances.forms.length>0){for(var i=0,j=ui.instances.forms.length;i<j;i++){if(ui.instances.forms[i].element===conf.element){return{exists:true,object:ui.instances.forms[i]};};};};}
var that=ui.controllers();var status=false;$(conf.element).bind('submit',function(event){that.prevent(event);});$(conf.element).find(":submit").unbind('click');if(!conf.messages)conf.messages={};conf.messages["general"]=conf.messages["general"]||"Revisa los datos, por favor.";var createError=function(){$(conf.element).before('<p class="ch-validator"><span class="ico error">Error: </span>'+conf.messages["general"]+'</p>');};var removeError=function(){$('.ch-validator').remove();};var checkStatus=function(){for(var i=0,j=that.children.length;i<j;i++){if(!that.children[i].status){if(!status)removeError();createError();status=false;ui.utils.body.trigger(ui.events.CHANGE_LAYOUT);return;};};if(!status){removeError();status=true;ui.utils.body.trigger(ui.events.CHANGE_LAYOUT);};};var validate=function(event){that.callbacks(conf,'beforeValidate');that.prevent(event);for(var i=0,j=that.children.length;i<j;i++){that.children[i].validate();};checkStatus();that.callbacks(conf,'afterValidate');return conf.publish;};var submit=function(event){that.callbacks(conf,'beforeSubmit');that.prevent(event);validate(event);if(status){if(conf.callbacks&&conf.callbacks.submit)conf.callbacks.submit();conf.element.submit();};that.callbacks(conf,'afterSubmit');return conf.publish;};var clear=function(event){that.prevent(event);conf.element.reset();removeError();for(var i=0,j=that.children.length;i<j;i++)that.children[i].reset();return conf.publish;};$(conf.element).bind('submit',function(event){that.prevent(event);submit(event);});$(conf.element).find(":reset, .resetForm").bind('click',clear);conf.publish={uid:conf.id,element:conf.element,type:"forms",children:that.children,validate:function(event){return validate(event)},checkStatus:function(event){return checkStatus(event)},submit:function(event){return submit(event)},clear:function(event){return clear(event)}}
return conf.publish;};ui.viewer=function(conf){var that=ui.controllers();var $viewer=$(conf.element);$viewer.addClass("ch-viewer");var viewerModal={};viewerModal.carouselStruct=$(conf.element).find("ul").clone().addClass("carousel");viewerModal.carouselStruct.find("img").each(function(i,e){$(e).attr("src",$(e).parent().attr("href")).unwrap();});viewerModal.showContent=function(){$(".ch-viewer-modal-content").parent().addClass("ch-viewer-modal");$(".ch-viewer-modal-content").html(viewerModal.carouselStruct);that.children[2]=viewerModal.carousel=$(".ch-viewer-modal-content").carousel({pager:true});$(".ch-viewer-modal-content .ch-carousel-content").css("left",0);viewerModal.carousel.select(thumbnails.selected);viewerModal.modal.position();};viewerModal.hideContent=function(){$("ch-viewer-modal").remove();viewerModal.carouselStruct.css("left","0");for(var i=0,j=ui.instances.carousel.length;i<j;i+=1){if(ui.instances.carousel[i].element===viewerModal.carousel.element){ui.instances.carousel.splice(i,1);return;}};};that.children[1]=viewerModal.modal=$("<a>").modal({content:"<div class=\"ch-viewer-modal-content\">",width:600,height:545,callbacks:{show:viewerModal.showContent,hide:viewerModal.hideContent}});var showcase={};showcase.wrapper=$("<div>").addClass("ch-viewer-display");showcase.display=$(conf.element).children(":first");$viewer.append(showcase.wrapper.append(showcase.display).append("<div class=\"ch-lens\">"));showcase.children=showcase.display.find("a");showcase.itemWidth=$(showcase.children[0]).parent().outerWidth();showcase.lens=$viewer.find(".ch-lens")
ui.positioner({element:$(showcase.lens),context:$(".ch-viewer li"),offset:"-20px 0"});showcase.lens.bind("click",function(event){viewerModal.modal.show();});showcase.wrapper.bind("mouseover",function(){showcase.lens.fadeIn(400);}).bind("mouseleave",function(){showcase.lens.fadeOut(400);});var extraWidth=(ui.utils.html.hasClass("ie6"))?showcase.itemWidth:0;showcase.display.css('width',(showcase.children.length*showcase.itemWidth)+extraWidth).addClass("ch-viewer-content")
showcase.children.bind("click",function(event){that.prevent(event);viewerModal.modal.show();});var thumbnails={};thumbnails.selected=0;thumbnails.wrapper=$("<div>").addClass("ch-viewer-triggers");$viewer.append(thumbnails.wrapper.append($viewer.find("ul").clone().addClass("carousel")));thumbnails.children=thumbnails.wrapper.find("a");thumbnails.children.find("img").each(function(i,e){$(e).attr("src",$(e).attr("src").replace("v=V","v=M"));$(e).parent().bind("click",function(event){that.prevent(event);select(i);});});that.children[0]=thumbnails.carousel=thumbnails.wrapper.carousel();var select=function(item){if(item>showcase.children.length-1||item<0||isNaN(item)){alert("Error: Expected to find a number between 0 and "+(showcase.children.length-1)+".");return conf.publish;};var visibles=thumbnails.carousel.getSteps();var page=thumbnails.carousel.getPage();var nextPage=~~(item/visibles)+1;$(thumbnails.children[thumbnails.selected]).removeClass("ch-thumbnail-on");$(thumbnails.children[item]).addClass("ch-thumbnail-on");var movement={left:-item*showcase.itemWidth};if(ui.features.transition){showcase.display.css(movement);}else{showcase.display.animate(movement);};if(thumbnails.selected<visibles&&item>=visibles&&nextPage>page){thumbnails.carousel.next();}else if(thumbnails.selected>=visibles&&item<visibles&&nextPage<page){thumbnails.carousel.prev();};thumbnails.selected=item;return conf.publish;};conf.publish={uid:conf.id,element:conf.element,type:"viewer",children:that.children,select:function(i){that.callbacks(conf,'select');return select(i);}}
select(0);return conf.publish;};ui.chat=function(conf){var that=ui.object();if(conf.msg){conf.ruleGroupName=conf.msg;}
that.load=function(){loadChat(conf.ruleGroupName,conf.element.id,conf.style||"block",conf.template||"1");}
ui.get({method:"component",name:"chat",script:conf.service||"http://www.mercadolibre.com.ar/org-img/jsapi/chat/chatRBIScript.js",callback:function(){that.load();}});that.publish={uid:conf.id,element:conf.element,type:"chat"}
return that.publish;}
ui.expando=function(conf){var that=ui.navs();$(conf.element).children(':first').wrapInner("<span class=\"ch-expando-trigger\"></span>");$(conf.element).addClass('ch-expando');conf.$trigger=$(conf.element).find(".ch-expando-trigger");conf.$htmlContent=conf.$trigger.parent().next();conf.publish=that.publish;conf.open=conf.open||false;var show=function(event){if(that.status){return hide();};that.show(event,conf);return conf.publish;};var hide=function(event){that.hide(event,conf);return conf.publish;};conf.$trigger.bind('click',function(event){that.prevent(event);show();}).addClass('ch-expando-trigger')
conf.$htmlContent.bind('click',function(event){event.stopPropagation()}).addClass('ch-expando-content');if(conf.open)show();conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="expando";conf.publish.open=conf.open;conf.publish.show=function(){return show()};conf.publish.hide=function(){return hide()};return conf.publish;};
ui.init();
})(jQuery);